<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cartão AR - Rosa Encantada</title>

    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-image-aframe.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>

  <style>
   body { margin: 0; overflow: hidden; }
   #splash-screen {
   position: fixed; top: 0; left: 0; width: 100%; height: 100%;
   background: #333; color: white; display: flex; flex-direction: column;
   justify-content: center; align-items: center; z-index: 9999;
   text-align: center;
  }
   #start-button {
   padding: 15px 30px;
   background-color: #007bff;
   color: white; font-size: 1.1em;
   border: none; border-radius: 8px;
   cursor: pointer; margin-top: 15px;
  }
   #logo {
   width: 120px;
   margin-bottom: 20px;
  }
   #minha-cena { display: none; }
 </style>
</head>

<body>
    <div id="splash-screen">
    <img id="logo" src="../assets/imagens/rosa.jpg" alt="Logo Rosa Encantada">
    <h2>Cartão de Natal AR</h2>
    <p>Toque para iniciar a câmera e ativar o som</p>
    <button id="start-button">Iniciar</button>
    </div>

    <a-scene
      id="minha-cena"
      mindar-image="imageTargetSrc: ../markers/targets.mind; maxTrack: 3;" 
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false">

      <a-assets>
        <audio id="som1" src="../assets/musicas/natal.mp3" preload="auto"></audio>
        <audio id="som2" src="../assets/musicas/natal.mp3" preload="auto"></audio>
        <audio id="som3" src="../assets/musicas/natal.mp3" preload="auto"></audio>

        <a-asset-item id="modeloA" src="../assets/modelos/bonecoNeve.glb"></a-asset-item>
        <a-asset-item id="modeloB" src="../assets/modelos/arvoreNatal.glb"></a-asset-item>
        <a-asset-item id="modeloC" src="../assets/modelos/presente.glb"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 -5" look-controls="enabled: false"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0" id="targetA">
        <a-plane src="../assets/imagens/cartao-rosaencantada.jpeg" width="1.1" height="1.5"></a-plane>
        <a-gltf-model 
           id="modelo-0" 
           src="#modeloA" 
           scale="0.5 0.5 0.5" 
           position="0 0 0.1" 
           visible="false"
           animation-mixer="clip: *; loop: repeat; timeScale: 0">
        </a-gltf-model>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 1" id="targetB">
        <a-plane src="../assets/imagens/cartao-rosaencantada.jpeg" width="1.1" height="1.5"></a-plane>
        <a-gltf-model 
           id="modelo-1" 
           src="#modeloB" 
           scale="0.5 0.5 0.5" 
           position="0 0 0.1" 
           visible="false"
           animation-mixer="clip: *; loop: repeat; timeScale: 0">
        </a-gltf-model>
        </a-entity>

        <a-entity mindar-image-target="targetIndex: 2" id="targetC">
        <a-plane src="../assets/imagens/cartao-rosaencantada.jpeg" width="1.1" height="1.5"></a-plane>
        <a-gltf-model 
           id="modelo-2" 
           src="#modeloC" 
           scale="0.5 0.5 0.5" 
           position="0 0 0.1" 
           visible="false"
           animation-mixer="clip: *; loop: repeat; timeScale: 0">
        </a-gltf-model>
        </a-entity>
        </a-scene>
        
    <script>
       const splash = document.getElementById('splash-screen');
       const startBtn = document.getElementById('start-button');
       const scene = document.getElementById('minha-cena');

    // Sons
       const audios = [
       new Audio('../assets/musicas/natal.mp3'), // Índice 0
       new Audio('../assets/musicas/natal.mp3'), // Índice 1
       new Audio('../assets/musicas/natal.mp3') // Índice 2
       ];
       audios.forEach(a => a.loop = true);

       startBtn.addEventListener('click', () => {
       splash.style.display = 'none';
       scene.style.display = 'block';
      });

      // Função para controle de som, visibilidade e animação
      function setupTarget(targetId, modeloId, audioIndex) {
      const target = document.querySelector(targetId);
      const modelo = document.querySelector(modeloId);
      const audio = audios[audioIndex];

      target.addEventListener('targetFound', () => {
      // 1. Animação: Inicia (timeScale: 1)
      modelo.setAttribute('animation-mixer', 'timeScale', 1);
      // 2. Visibilidade: Ativa
      modelo.setAttribute('visible', 'true');

      // 3. Som: Ativa o som correto e pausa os outros
      audios.forEach((a, i) => { if (i !== audioIndex) a.pause(); });
      audio.currentTime = 0;
      audio.play();
    });

       target.addEventListener('targetLost', () => {
       // 1. Animação: Pausa (timeScale: 0)
       modelo.setAttribute('animation-mixer', 'timeScale', 0);
       // 2. Visibilidade: Desativa
       modelo.setAttribute('visible', 'false');
       // 3. Som: Pausa
       audio.pause();
      });
     }

    // Mapeamento:
    // targetIndex 0 (primeira imagem no targets.mind) -> modelo-0 (#modeloA: ArvoreNatal) -> áudio 0
    setupTarget('#targetA', '#modelo-0', 0);
  
    // targetIndex 1 (segunda imagem no targets.mind) -> modelo-1 (#modeloB: BonecoNeve) -> áudio 1
    setupTarget('#targetB', '#modelo-1', 1);
 
    // targetIndex 2 (terceira imagem no targets.mind) -> modelo-2 (#modeloC: Presente) -> áudio 2
    setupTarget('#targetC', '#modelo-2', 2);
  </script>
</body>
</html>